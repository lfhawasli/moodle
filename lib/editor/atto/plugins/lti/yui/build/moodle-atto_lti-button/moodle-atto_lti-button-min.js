YUI.add("moodle-atto_lti-button",function(e,t){require(["core/str"],function(e){var t=null,n=e.get_string("erroroccurred","atto_lti");$.when(n).done(function(e){t=e}),document.CALLBACKS={handleError:function(e){alert(t);for(var n=0;n<e.length;n++)console.error(e[n])}}}),e.namespace("M.atto_lti").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_CREATEACTIVITYURL:M.cfg.wwwroot+"/lib/editor/atto/plugins/lti/view.php",_CONTENT_ITEM_SELECTION_URL:M.cfg.wwwroot+"/lib/editor/atto/plugins/lti/contentitem.php",_panel:null,_addTool:function(t,n){t.preventDefault();var r=this._createResourceLinkId(),i=this.get("host"),s,o=this._course;document.CALLBACKS["f"+r]=function(t){if(!t)return;s.hide();for(var u=0;u<t["@graph"].length;u++){var a=t["@graph"][u],f=new e.M.atto_lti.PlacementStrategyFactory,l=f.strategyFor(a,o,r,n),c=l.toHtml;i.insertContentAtFocusPoint(c(a))}i.saveSelection(),i.updateOriginal(),s.destroy()},this._panel=new M.core.dialogue({bodyContent:'<iframe src="'+this._CONTENT_ITEM_SELECTION_URL+"?course="+this._course.id+"&id="+n.id+"&callback=f"+r+'" width="100%" height="100%"></iframe>',headerContent:n.name,width:"67%",height:"66%",draggable:!1,visible:!0,zindex:100,modal:!0,focusAfterHide:i.editor,focusOnPreviousTargetAfterHide:!0,render:!0}),this._panel.after("visibleChange",function(){this._panel.destroy()},this),s=this._panel},initializer:function(e){console.log("hello1",e),e.toolTypes.length>0&&(console.log("hello2",e),this._course=e.course,this._createResourceLinkId=function(e){return function(){return e+"_"+(new Date).getTime()}}(e.resourcebase),this.addToolbarMenu({icon:M.util.image_url("icon","mod_lti"),globalItemConfig:{callback:this._addTool},items:e.toolTypes.map(function(e){return{text:e.name,callbackArgs:e}})}))}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
