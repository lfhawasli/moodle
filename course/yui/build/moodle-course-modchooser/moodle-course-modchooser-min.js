YUI.add("moodle-course-modchooser",function(e,t){var n={PAGECONTENT:"body",SECTION:null,SECTIONMODCHOOSER:"span.section-modchooser-link",SITEMENU:"div.block_site_main_menu",SITETOPIC:"div.sitetopic"},r="course-modchooser",i=function(){i.superclass.constructor.apply(this,arguments)};e.extend(i,M.core.chooserdialogue,{sectionid:null,userpinnedtools:[],defaulttools:"",initializer:function(t){var r=M.course.format.get_sectionwrapperclass();r&&(n.SECTION="."+r);var i=e.one(".chooserdialoguebody"),s=e.one(".choosertitle"),o={};this.setup_chooser_dialogue(i,s,o),this.setup_for_section(),M.course.coursebase.register_module(this),t.userpinnedtools&&(this.userpinnedtools=t.userpinnedtools.split(",")),t.defaulttools&&(this.defaulttools=t.defaulttools),e.all(".block_settings #settingsnav .type_course .modchoosertoggle a").on("click",this.toggle_mod_chooser,this)},setup_for_section:function(t){t||(t=n.PAGECONTENT),e.one(t).all(n.SITETOPIC).each(function(e){this._setup_for_section(e)},this),n.SECTION&&e.one(t).all(n.SECTION).each(function(e){this._setup_for_section(e)},this),e.one(t).all(n.SITEMENU).each(function(e){this._setup_for_section(e)},this)},_setup_for_section:function(t){var r=t.one(n.SECTIONMODCHOOSER);if(!r)return;var i=e.Node.create("<a href='#' />");r.get("children").each(function(e){i.appendChild(e)}),r.insertBefore(i),i.on("click",this.display_mod_chooser,this)},display_mod_chooser:function(t){if(t.target.ancestor(n.SITETOPIC))this.sectionid=1;else if(t.target.ancestor(n.SECTION)){var r=t.target.ancestor(n.SECTION);this.sectionid=r.get("id").replace("section-","")}else t.target.ancestor(n.SITEMENU)&&(this.sectionid=0);this.display_chooser(t);var i=this.container.one("#showalltools"),s=i.on("click",function(e){this.container.all(".tool:not(.pinned)").each(function(e){e.toggleView()}),this.container.all("i").each(function(e){e.toggleView()}),this.container.one("#resettools").toggleView();var t=M.util.get_string("showcategory","moodle","favorite tools"),n=M.util.get_string("showall","moodle","tools");i.getContent()===t?i.setContent(n):i.setContent(t),e.preventDefault()},this);this.listenevents.push(s);var o=this.userpinnedtools;s=this.container.delegate("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=this.ancestor(".tool"),n=this.ancestor().previous("input").getAttribute("id").split("module_")[1];o.push(n),M.util.set_user_preference("pinnedtools",o.join(",")),t.addClass("pinned"),this.removeClass("fa-star-o"),this.addClass("fa-star"),this.setStyle("color","#f29644"),this.setStyle("font-size","103%")},".fa-star-o"),this.listenevents.push(s),s=this.container.delegate("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=this.ancestor(".pinned"),n=this.ancestor().previous("input").getAttribute("id").split("module_")[1];o=o.filter(function(e){return e!==n}),M.util.set_user_preference("pinnedtools",o.join(",")),t.removeClass("pinned"),this.removeClass("fa-star"),this.addClass("fa-star-o"),this.setStyle("color","#555"),this.setStyle("font-size","100%")},".fa-star"),this.listenevents.push(s);var u=this.defaulttools;s=e.one("#resettools").on("click",function(t){t.preventDefault(),t.stopImmediatePropagation(),M.util.set_user_preference("pinnedtools",u);var n=u.split(",");e.all(".tool").each(function(e){var t=e.one("input").getAttribute("id").split("module_")[1],r;n.indexOf(t)!==-1?(e.addClass("pinned"),e.show(),r=e.one("i"),r.removeClass("fa-star-o"),r.addClass("fa-star"),r.setStyle("color","#f29644"),r.setStyle("font-size","103%")):(e.removeClass("pinned"),r=e.one("i"),r.removeClass("fa-star"),r.addClass("fa-star-o"),r.setStyle("color","#555"),r.setStyle("font-size","100%"))})}),this.listenevents.push(s)},toggle_mod_chooser:function(t){var n=e.all("div.addresourcemodchooser"),r=e.all("div.addresourcedropdown");if(n.size()===0)return;var i=e.one(".block_settings #settingsnav .type_course .modchoosertoggle a"),s=i.get("lastChild"),o;n.item(0).hasClass("visibleifjs")?(o=0,n.removeClass("visibleifjs").addClass("hiddenifjs"),r.addClass("visibleifjs").removeClass("hiddenifjs"),s.set("data",M.util.get_string("modchooserenable","moodle")),i.set("href",i.get("href").replace("off","on"))):(o=1,n.addClass("visibleifjs").removeClass("hiddenifjs"),r.removeClass("visibleifjs").addClass("hiddenifjs"),s.set("data",M.util.get_string("modchooserdisable","moodle")),i.set("href",i.get("href").replace("on","off"))),M.util.set_user_preference("usemodchooser",o),t.preventDefault()},option_selected:function(e){this.hiddenRadioValue.setAttrs({name:"jump",value:e.get("value")+"&section="+this.sectionid})}},{NAME:r,ATTRS:{maxheight:{value:800}}}),M.course=M.course||{},M.course.init_chooser=function(e){return new i(e)}},"@VERSION@",{requires:["moodle-core-chooserdialogue","moodle-course-coursebase"]});
