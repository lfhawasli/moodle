define(["jquery","jwplayer"],function(a,b){return{init:function(c,d,e,f,g,h,i,j){var k="player-"+d,l=b(k),m=M.util.get_string("playbackrates","filter_oidwowza"),n=M.util.get_string("rewind","filter_oidwowza"),o={localization:{settings:m,rewind:n}};1===f?(o.autostart=!0,o.width="100%",o.aspectratio="3:2",o.primary="html5",o.playlist=[{sources:[{file:e},{file:h}]}],"vidres"===g&&(i&&(o.playlist[0].tracks=[{file:i,kind:"captions","default":!0}]),j&&(o.plugins={"hd-2":{file:j,state:!0}}))):(o.image=M.cfg.wwwroot+"/filter/oidwowza/pix/audio-only.png",o.height=200,o.autostart=!0,o.sources=[{file:h},{file:e}],o.rtmp={bufferlength:3},o.modes=[{type:"html5"},{type:"flash"}]),l.setup(o);var p=0,q=!1,r=!1,s=!1,t=function(){l.seek(l.getPosition()+10)},u=M.util.get_string("skipahead","filter_oidwowza");l.addButton(M.cfg.wwwroot+"/filter/oidwowza/pix/fast-forward.svg",u,t,"jw-btn-fastforward","jw-fastforward"),l.on("beforePlay",function(){r||(a(".jw-fastforward.jw-icon-inline").insertAfter(".jw-icon-playback"),a(".jw-icon-rewind.jw-icon-inline").insertBefore(".jw-icon-playback"),r=!0)});var v=new URL(window.location).searchParams;v.get("offset")&&(p=v.get("offset"),q=!0),l.on("ready",function(){q===!0&&l.play()}),l.on("firstFrame",function(){l.seek(p)}),f||s||l.on("time",function(){!s&&isFinite(l.getDuration())&&(l.seek(p),s=!0)});var w=function(){var a=parseInt(l.getPosition(),10);a===parseInt(l.getDuration(),10)&&(a="FINISHED"),M.util.set_user_preference(c,a)},x=function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],{name:"IE",version:a[1]||""}):"Chrome"===c[1]&&(a=b.match(/\bOPR|Edge\/(\d+)/),null!==a)?{name:"Opera",version:a[1]}:(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),{name:c[0],version:c[1]})};"Safari"==x().name&&setInterval(w,3e4),a(window).on("beforeunload",function(){w()})}}});