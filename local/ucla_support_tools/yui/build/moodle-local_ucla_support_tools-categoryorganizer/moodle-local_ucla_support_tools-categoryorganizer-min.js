YUI.add("moodle-local_ucla_support_tools-categoryorganizer",function(e,t){M.local_ucla_support_tools=M.local_ucla_support_tools||{},M.local_ucla_support_tools.categoryorganizer={init:function(){M.local_ucla_support_tools.dragdrop.init(),M.local_ucla_support_tools.filter.categories(),M.local_ucla_support_tools.filter.tools({input_node_id:"#ucla-support-category-filter-input",target_nodes:".ucla-support-tool-category-list .ucla-support-tool",filter_nodes:".ucla-support-tool-category-list .ucla-support-category li"});var t=M.local_ucla_support_tools.dialog.form_with_inputs(new e.ArrayList([{label:"Name for category",name:"catname",placeholder:"Enter a category name"},{label:"Color",name:"cathex",placeholder:""}])),n='<div class="picker well"><div id="hue-dial"></div><div class="sliders"><div id="sat-slider"><strong>Saturation: <span></span></strong></div><div id="lum-slider"><strong>Luminance: <span></span></strong></div></div><div class="color"></div></div>';t.appendChild(e.Node.create(n));var r=M.local_ucla_support_tools.dialog.create({id:"create-category-dialog",title:"Create a new category",body:t.getHTML(),cancel:"Cancel",proceed:"Create category"});e.one(".ucla-support-tool-category-button-add").on("click",function(){this.init_color_slider(),r.callback=M.local_ucla_support_tools.categoryorganizer.create_category,r.validate=function(){return new e.ArrayList([e.one("#catname-output")])},r.show()},this),e.one(".ucla-support-tool-category-list ul").delegate("click",function(e){e.preventDefault();var t=e.currentTarget.getData("id");this.delete_category(t)},'.ucla-support-category-header a[data-action="delete"]',this),e.one(".ucla-support-tool-category-list ul").delegate("click",function(e){e.preventDefault();var t=e.currentTarget.getData("id"),n=e.currentTarget.ancestor(".ucla-support-category").getData("id");this.remove_tool({toolid:t,catid:n})},'.ucla-support-tool-title a[data-action="remove"]',this)},init_color_slider:function(t){function a(e){typeof e.h!="undefined"&&n.set("value",+e.h),typeof e.s!="undefined"&&r.set("value",+e.s),typeof e.l!="undefined"&&i.set("value",+e.l)}function f(){var t=n.get("value"),a=r.get("value"),f=i.get("value"),l=e.Color.fromArray([t,a,f],e.Color.TYPES.HSL),c=e.Color.toHex(l);s.set("text",a+"%"),o.set("text",f+"%"),u.setStyle("backgroundColor",c),h(l)}function h(t){l!==c&&l.set("value",e.Color.toHex(t))}function p(t){var n=t.newVal,r=[];e.Color.toArray(n)&&(r=e.Color.toArray(e.Color.toHSL(n)),a({h:r[0],s:r[1],l:r[2]}))}function d(e){c=e.currentTarget}function v(e){c===e.currentTarget&&(c=null)}var n=new e.Dial({min:0,max:360,stepsPerRevolution:360,continuous:!0,centerButtonDiameter:.4,render:"#hue-dial"}),r=new e.Slider({min:0,max:100,value:100,render:"#sat-slider"}),i=new e.Slider({min:0,max:100,value:50,render:"#lum-slider"}),s=e.one("#sat-slider span"),o=e.one("#lum-slider span"),u=e.one(".color");n.after("valueChange",function(e){f()}),r.after("thumbMove",function(e){f()}),i.after("thumbMove",function(e){o.set("text",i.get("value")+"%"),f()});var l=e.one("#cathex-output"),c=null;l.on("focus",d),l.on("blur",v),l.on("valueChange",p),f()},create_category:function(){var t=e.one("#catname-output").get("value"),n=e.one("#cathex-output").get("value").replace("#",""),r=e.one("#create-category-dialog .alert");r&&r.remove(!0);var i={name:t,color:n},s=!1;return e.io(M.cfg.wwwroot+"/local/ucla_support_tools/rest.php",{method:"POST",data:{action:"createcategory",json:JSON.stringify(i),sesskey:M.cfg.sesskey},on:{success:function(t,n){var r=JSON.parse(n.responseText);if(r.status){var i="<li>"+r.category_html+"</li>";e.one(".ucla-support-tool-category-list ul").appendChild(i),M.local_ucla_support_tools.dragdrop.set_drop_events(e.one('.ucla-support-category[data-id="'+r.id+'"]')),i="<li>"+r.category_label+"</li>",e.one(".ucla-support-tool-category-labels ul").appendChild(i)}else r.error.msg.indexOf("Error writing to database")!==-1&&e.one("#create-category-dialog h3.title").insert('<div class="alert alert-warning" role="alert"><strong>Unable to create category!</strong> Perhaps you already have a category with the same name?</div>',"after");s=r.status}},sync:!0}),s},delete_category:function(t){var n=M.local_ucla_support_tools.dialog.create({id:"delete-category-dialog",title:"Delete category",body:"Are you sure you want to delete this category?",cancel:"Cancel",proceed:"Delete category"});n.callback=function(){return e.io(M.cfg.wwwroot+"/local/ucla_support_tools/rest.php",{method:"POST",data:{action:"deletecategory",json:JSON.stringify({id:t}),sesskey:M.cfg.sesskey},on:{success:function(t,n){var r=JSON.parse(n.responseText);r.status&&(e.one('.ucla-support-category[data-id="'+r.id+'"]').ancestor("li").remove(!0),e.one('.ucla-support-category-header[data-id="'+r.id+'"]').ancestor("li").remove(!0))}}}),!0},n.show()},add_tool:function(t){e.io(M.cfg.wwwroot+"/local/ucla_support_tools/rest.php",{method:"POST",data:{action:"addtooltocategory",sesskey:M.cfg.sesskey,json:JSON.stringify(t)}})},remove_tool:function(t){return e.io(M.cfg.wwwroot+"/local/ucla_support_tools/rest.php",{method:"POST",data:{action:"removetoolfromcategory",sesskey:M.cfg.sesskey,json:JSON.stringify(t)},on:{success:function(t,n){var r=JSON.parse(n.responseText);r.status&&e.one('.ucla-support-category[data-id="'+r.catid+'"] .ucla-support-tool[data-id="'+r.toolid+'"]').ancestor("li").remove(!0)}}}),!0}}},"@VERSION@",{requires:["base","node","moodle-local_ucla_support_tools-dialog","dial","slider","event-valuechange","color","io","arraylist","moodle-local_ucla_support_tools-dragdrop","moodle-local_ucla_support_tools-filter"]});
