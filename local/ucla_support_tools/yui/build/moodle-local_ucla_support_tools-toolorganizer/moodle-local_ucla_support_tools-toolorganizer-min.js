YUI.add("moodle-local_ucla_support_tools-toolorganizer",function(e,t){M.local_ucla_support_tools=M.local_ucla_support_tools||{},M.local_ucla_support_tools.toolorganizer={init:function(){M.local_ucla_support_tools.filter.tools({input_node_id:"#ucla-support-tools-filter-input",target_nodes:".ucla-support-tool-alltools .ucla-support-tool",filter_nodes:".ucla-support-tool-alltools li"});var t=M.local_ucla_support_tools.dialog.form_with_inputs(new e.ArrayList([{label:"Name",name:"toolname",placeholder:"Enter a name for this tool"},{label:"Link",name:"toolurl",placeholder:"Link for this tool"},{label:"Documentation link",name:"tooldocs",placeholder:"Documentation link?"}])),n='<div class="form-group"><label for="desc-output" >Description</label><textarea id="tooldesc-output" class="form-control" rows="5" placeholder="Description is searchable"></textarea></div>';t.appendChild(e.Node.create(n));var r=M.local_ucla_support_tools.dialog.create({id:"create-tool-dialog",title:"Create a new tool",body:t.getHTML(),cancel:"Cancel",proceed:"Create tool"});e.one(".ucla-support-tool-button-add").on("click",function(t){t.preventDefault(),r.reset(),r.callback=M.local_ucla_support_tools.toolorganizer.create_tool,r.validate=function(){return new e.ArrayList([e.one("#toolname-output"),e.one("#tooldesc-output"),e.one("#toolurl-output")])},r.show()},this),e.one(".ucla-support-tool-alltools ul").delegate("click",function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-id");this.delete_tool(t)},'.ucla-support-tool-title a[data-action="delete"]',this)},create_tag_input:function(t,n){t.plug(e.Plugin.AutoComplete,{allowTrailingDelimiter:!0,minQueryLength:0,queryDelay:0,queryDelimiter:",",source:n,resultHighlighter:"startsWith",resultFilters:["startsWith",function(n,r){var i=t.get("value").split(/\s*,\s*/);return i=e.Array.hash(i),e.Array.filter(r,function(e){return!i.hasOwnProperty(e.text)})}]}),t.on("focus",function(){t.ac.sendRequest("")}),t.ac.after("select",function(){setTimeout(function(){t.ac.sendRequest(""),t.ac.show()},1)})},create_tool:function(){var t=e.one("#toolname-output").get("value"),n=e.one("#tooldesc-output").get("value"),r=e.one("#toolurl-output").get("value"),i=e.one("#tooldocs-output").get("value"),s=e.one("#create-tool-dialog .alert");s&&s.remove(!0);var o={name:t,desc:n,url:r,docsurl:i},u=!1;return e.io(M.cfg.wwwroot+"/local/ucla_support_tools/rest.php",{method:"POST",data:{action:"createtool",json:JSON.stringify(o),sesskey:M.cfg.sesskey},on:{success:function(t,n){var r=JSON.parse(n.responseText);if(r.status){var i="<li>"+r.html+"</li>";e.one(".ucla-support-tool-alltools ul").appendChild(i)}else{if(r.error.msg.indexOf("out_as_local_url")!==-1){var s=e.one("#toolurl-output").ancestor(".form-group");s.addClass("has-error"),s.one("label").setHTML("URL needs to be from this server")}r.error.msg.indexOf("Error writing to database")!==-1&&e.one("#create-tool-dialog h3.title").insert('<div class="alert alert-warning" role="alert"><strong>Unable to create tool!</strong> Perhaps you are reusing the name or the link?</div>',"after")}u=r.status},failure:function(e,t){return!1}},sync:!0}),u},delete_tool:function(t){var n=M.local_ucla_support_tools.dialog.create({id:"delete-tool-dialog",title:"Delete tool",body:"Are you sure you want to permanently delete this tool?",cancel:"Cancel",proceed:"Delete tool"});n.callback=function(){return e.io(M.cfg.wwwroot+"/local/ucla_support_tools/rest.php",{method:"POST",data:{action:"deletetool",json:JSON.stringify({id:t}),sesskey:M.cfg.sesskey},on:{success:function(t,n){var r=JSON.parse(n.responseText);r.status&&e.all('.ucla-support-tool[data-id="'+r.id+'"]').each(function(e){e.ancestor("li").remove(!0)})}}}),!0},n.show()}}},"@VERSION@",{requires:["base","node","panel","io","autocomplete","autocomplete-filters","autocomplete-highlighters","moodle-local_ucla_support_tools-filter"]});
