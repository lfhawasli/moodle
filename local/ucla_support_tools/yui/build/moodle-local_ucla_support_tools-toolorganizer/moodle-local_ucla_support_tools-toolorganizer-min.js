YUI.add("moodle-local_ucla_support_tools-toolorganizer",function(e,t){M.local_ucla_support_tools=M.local_ucla_support_tools||{},M.local_ucla_support_tools.toolorganizer={init:function(){var t=M.local_ucla_support_tools.dialog.form_with_inputs(new e.ArrayList([{label:"Name",name:"toolname",placeholder:"Enter a name for this tool"},{label:"Link",name:"toolurl",placeholder:"Link for this tool"},{label:"Documentation link",name:"tooldocs",placeholder:"Documentation link?"}])),n='<div class="form-group"><label for="desc-output" >Description</label><textarea id="tooldesc-output" class="form-control" rows="5" placeholder="Description is searchable"></textarea></div>';t.appendChild(e.Node.create(n)),e.one(".ucla-support-tool-button-add").on("click",function(n){n.preventDefault();var r=M.local_ucla_support_tools.dialog.create({id:"create-tool-dialog",title:"Create a new tool",body:t.getHTML(),cancel:"Cancel",proceed:"Create tool"});r.reset(),r.callback=M.local_ucla_support_tools.toolorganizer.create_tool,r.validate=function(){return new e.ArrayList([e.one("#toolname-output"),e.one("#tooldesc-output"),e.one("#toolurl-output")])},r.show()},this),e.one(".ucla-support-tool-alltools ul").delegate("click",function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-id");this.delete_tool(t)},'a[data-action="delete"]',this),e.one(".ucla-support-tool-alltools ul").delegate("click",function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-id");this.edit_tool(t)},'a[data-action="edit"]',this)},create_tag_input:function(t,n){t.plug(e.Plugin.AutoComplete,{allowTrailingDelimiter:!0,minQueryLength:0,queryDelay:0,queryDelimiter:",",source:n,resultHighlighter:"startsWith",resultFilters:["startsWith",function(n,r){var i=t.get("value").split(/\s*,\s*/);return i=e.Array.hash(i),e.Array.filter(r,function(e){return!i.hasOwnProperty(e.text)})}]}),t.on("focus",function(){t.ac.sendRequest("")}),t.ac.after("select",function(){setTimeout(function(){t.ac.sendRequest(""),t.ac.show()},1)})},create_tool:function(){return M.local_ucla_support_tools.toolorganizer.update_tool("createtool",function(t){var n="<li>"+t.html+"</li>";e.one(".ucla-support-tool-alltools ul").appendChild(n)})},delete_tool:function(t){var n=M.local_ucla_support_tools.dialog.create({id:"delete-tool-dialog",title:"Delete tool",body:"Are you sure you want to permanently delete this tool?",cancel:"Cancel",proceed:"Delete tool"});n.callback=function(){return e.io(M.cfg.wwwroot+"/local/ucla_support_tools/rest.php",{method:"POST",data:{action:"deletetool",json:JSON.stringify({id:t}),sesskey:M.cfg.sesskey},on:{success:function(t,n){var r=JSON.parse(n.responseText);r.status&&e.all('.ucla-support-tool[data-id="'+r.id+'"]').each(function(e){e.ancestor("li").remove(!0)})}}}),!0},n.show()},edit_tool:function(t){e.io(M.cfg.wwwroot+"/local/ucla_support_tools/rest.php",{method:"GET",data:{action:"gettooledit",json:JSON.stringify({id:t}),sesskey:M.cfg.sesskey},on:{success:function(e,t){var n=JSON.parse(t.responseText);if(n.status){var r=M.local_ucla_support_tools.dialog.create({id:"edit-tool-dialog",title:"Edit tool",body:n.html,cancel:"Cancel",proceed:"Save changes"});r.callback=M.local_ucla_support_tools.toolorganizer.edit_tool_callback,r.show()}}}})},edit_tool_callback:function(){var t=e.one("#toolid-output").get("value");return M.local_ucla_support_tools.toolorganizer.update_tool("updatetool",function(t){var n=e.Node.create(t.html);e.all('.ucla-support-tool[data-id="'+t.id+'"]').each(function(e){e.set("innerHTML",n.getHTML())})},{id:t})},update_tool:function(t,n,r){var i=e.one("#toolname-output").get("value"),s=e.one("#tooldesc-output").get("value"),o=e.one("#toolurl-output").get("value"),u=e.one("#tooldocs-output").get("value"),a=e.one("#create-tool-dialog .alert");a&&a.remove(!0);var f={name:i,desc:s,url:o,docsurl:u};r&&(f=e.merge(f,r));var l=!1;return e.io(M.cfg.wwwroot+"/local/ucla_support_tools/rest.php",{method:"POST",data:{action:t,json:JSON.stringify(f),sesskey:M.cfg.sesskey},on:{success:function(t,r){var i=JSON.parse(r.responseText);if(i.status)n(i);else if(i.error){if(i.error.msg.indexOf("out_as_local_url")!==-1){var s=e.one("#toolurl-output").ancestor(".form-group");s.addClass("has-error"),s.one("label").setHTML("URL needs to be from this server")}i.error.msg.indexOf("Error writing to database")!==-1&&e.one("#create-tool-dialog h3.title").insert('<div class="alert alert-warning" role="alert"><strong>Unable to create tool!</strong> Perhaps you are reusing the name or the link?</div>',"after")}l=i.status},failure:function(e,t){return!1}},sync:!0}),l}}},"@VERSION@",{requires:["base","node","panel","io","autocomplete","autocomplete-filters","autocomplete-highlighters","moodle-local_ucla_support_tools-filter"]});
