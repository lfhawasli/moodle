YUI.add("moodle-local_ucla-gradebooktable",function(e,t){M.local_ucla=M.local_ucla||{},M.local_ucla.gradebook={node_student_header_cell:{},node_student_cell:{},node_footer_row:{},init:function(){this.node_student_header_cell=e.one("#studentheader"),this.node_student_cell=e.one("#user-grades .user.cell"),this.node_footer_row=e.one("#user-grades .avg"),this.node_student_cell&&(this.float_user_column(),this.float_assignment_header(),this.float_user_header(),this.node_footer_row&&(this.float_assignment_footer(),this.update_assignment_footer_position()),this.update_assignment_header_position(),this.update_user_column_position(),M.block_ucla_help.sidebar.register_module(this),e.all("#user-grades .overridden").setAttribute("aria-label","Overriden grade"),window.onscroll=function(){M.local_ucla.gradebook.update_assignment_footer_position(),M.local_ucla.gradebook.update_assignment_header_position(),M.local_ucla.gradebook.update_user_column_position()},window.onresize=function(){M.local_ucla.gradebook.update_assignment_footer_position(),M.local_ucla.gradebook.update_assignment_header_position(),M.local_ucla.gradebook.update_user_column_position();var t=e.all("#gradebook-header-container .gradebook-header-cell"),n=e.all("#user-grades .heading .cell"),r=e.one("#studentheader").getX(),i=0;n.each(function(e,n){var s=t.item(n);i+=e.get("offsetWidth");var o={width:e.get("offsetWidth"),left:e.getX()-r+"px"};s.setStyles(o)});var s=e.all("#gradebook-footer-container .gradebook-footer-cell");if(s.size()!==0){var o=e.all("#user-grades .avg .cell");o.each(function(e,t){var n=s.item(t),i={width:e.get("offsetWidth"),left:e.getX()-r+"px"};n.setStyles(i)}),e.one("#gradebook-footer-container").setStyle("width",i)}e.one("#gradebook-header-container").setStyle("width",i)}),e.on("domready",function(){e.one(".gradebook-loading-screen").remove(!0)})},float_user_column:function(){var t=e.all("#user-grades .user.cell"),n=e.Node.create('<div aria-hidden="true" id="gradebook-user-container"></div>'),r=0,i=this.node_student_cell.getY();t.each(function(t){var s=e.Node.create('<div class="gradebook-user-cell"></div>'),o=t.cloneNode(!0);s.append(o.getHTML()),o=null,s.setStyles({height:t.get("offsetHeight")+"px",width:t.get("offsetWidth")+"px",position:"absolute",top:t.getY()-i+"px"}),r+=t.get("offsetHeight");var u=t.ancestor().getAttribute("class").split(" ").join(".");s.on("click",function(){e.one("."+u).all(".grade").toggleClass("hmarked")}),n.appendChild(s)},this),n.setStyles({position:"absolute",left:this.node_student_cell.getX()+"px",top:this.node_student_cell.getY()+"px",width:this.node_student_cell.get("offsetWidth"),height:r+"px","background-color":"#f9f9f9"}),e.one("body").append(n)},float_user_header:function(){var t=e.Node.create('<div aria-hidden="true" id="gradebook-user-header-container"></div>'),n=this.node_student_header_cell.cloneNode(!0);t.append(n.getHTML()),t.setStyles({position:"absolute",left:this.node_student_cell.getX()+"px",top:this.node_student_header_cell.getY()+"px",width:"200px",height:this.node_student_header_cell.get("offsetHeight")+"px"}),n=null,e.one("body").append(t)},float_assignment_header:function(){var t=e.all("#user-grades tr.heading .cell"),n=e.Node.create('<div aria-hidden="true" id="gradebook-header-container"></div>'),r=0,i=0,s=this.node_student_header_cell.getX();t.each(function(t){var o=t.getAttribute("class"),u=/c[0-9]+/g,a=u.exec(o);a=a[0].replace("c","");var f=parseInt(a,10);++f;var l=t.getX(),c=t.cloneNode(!0),h=e.Node.create('<div class="gradebook-header-cell"></div>');h.append(c.getHTML()),h.addClass(c.getAttribute("class")),c=null,h.setStyles({width:t.get("offsetWidth")+"px",height:t.get("offsetHeight")+"px",position:"absolute",left:l-s+"px"}),r+=parseInt(t.get("offsetWidth"),10),i=t.get("offsetHeight"),h.on("click",function(){e.all(".cell.c"+f).toggleClass("vmarked")}),n.appendChild(h)},this),n.setStyles({position:"absolute",top:this.node_student_header_cell.getY()+"px",left:this.node_student_header_cell.getX()+"px",width:r+"px",height:i+"px"}),e.one("body").append(n)},float_assignment_footer:function(){var t=e.all("#user-grades .lastrow .cell"),n=e.Node.create('<div aria-hidden="true" id="gradebook-footer-container"></div>'),r=0,i=this.node_footer_row.getX();t.each(function(t){var s=t.getX(),o=t.cloneNode(!0),u=e.Node.create('<div class="gradebook-footer-cell"></div>');u.append(o.getHTML()),u.setStyles({width:t.get("offsetWidth")+"px",height:"50px",position:"absolute",left:s-i+"px"}),n.append(u),r+=parseInt(t.get("offsetWidth"),10)},this);var s=e.one("#gradersubmit");if(s){var o=e.Node.create('<button class="btn btn-sm btn-default">'+s.getAttribute("value")+"</button>");o.on("click",function(){s.simulate("click")}),n.one(".gradebook-footer-cell").append(o)}n.setStyles({position:"absolute",left:this.node_footer_row.getX()+"px",bottom:"0",height:"50px",width:r+"px"}),e.one("body").append(n)},update_user_column_position:function(){var t=window.pageXOffset,n=e.one(".sidebar.active");n&&(t=n.get("offsetWidth")+window.pageXOffset);var r=document.querySelectorAll("#user-grades .user.cell")[0],i=r.offsetLeft+r.offsetParent.offsetLeft,s=document.getElementById("gradebook-user-container"),o=document.getElementById("gradebook-user-header-container");t>i&&(s.style.left=t+"px",o.style.left=t+"px"),t<i&&(s.style.left=i+"px",o.style.left=i+"px")},update_assignment_header_position:function(){var e=40,t=document.getElementById("gradebook-header-container"),n=document.getElementById("studentheader"),r=document.getElementById("gradebook-user-header-container");t.style.left=n.offsetLeft+n.offsetParent.offsetLeft+"px";var i=n.offsetTop+n.offsetParent.offsetTop;window.pageYOffset+e>i?(t.style.top=window.pageYOffset+e+"px",r.style.top=window.pageYOffset+e+"px"):(t.style.top=i+"px",r.style.top=i+"px")},update_assignment_footer_position:function(){var e=document.querySelectorAll("#user-grades .avg")[0];if(e===undefined)return;var t=document.getElementById("gradebook-footer-container"),n=e.offsetTop+
e.offsetParent.offsetTop,r=document.getElementById("studentheader");t.style.left=r.offsetLeft+r.offsetParent.offsetLeft+"px",window.pageYOffset+window.innerHeight<n?(t.style.top=window.pageYOffset+window.innerHeight-50+"px",t.classList.add("gradebook-footer-row-sticky")):(t.style.top=n+"px",t.classList.remove("gradebook-footer-row-sticky"))},sidebar_toggle:function(){this.update_assignment_footer_position(),this.update_assignment_header_position(),this.update_user_column_position()},sidebar_toggle_pre:function(){this.node_footer_row&&e.one("#gradebook-footer-container").hide(),e.one("#gradebook-user-container").hide(),e.one("#gradebook-user-header-container").hide(),e.one("#gradebook-header-container").hide()},sidebar_toggle_post:function(){this.node_footer_row&&e.one("#gradebook-footer-container").show(),e.one("#gradebook-user-container").show(),e.one("#gradebook-user-header-container").show(),e.one("#gradebook-header-container").show()}}},"@VERSION@",{requires:["node","event","node-event-simulate","moodle-block_ucla_help-doc_loader"]});
