define(["core/str","jquery","block_ucla_rearrange/jquery.mjs.nestedSortable"],function(a,b){var c,d={section:".section-item",sectionList:"#s-list",siteInfo:".section-zero",expand:".expand-button",expandall:".expandall"},e=function(){b(d.sectionList).nestedSortable({handle:"div",items:"li",listType:"ul",toleranceElement:"> div",cancel:d.siteInfo+" > div",doNotClear:!0,isAllowed:function(a,b,c){if(c.is(d.section+":not("+d.siteInfo+")")){var e=a.nextAll(d.siteInfo).length>0;return!e}return!0},protectRoot:!0,forcePlaceholderSize:!0,opacity:.6,placeholder:"placeholder",revert:200,tabSize:32,excludeRoot:!0,stop:g}),g()},f=function(){return a.get_strings([{key:"sectionexpand",component:"block_ucla_rearrange"},{key:"sectioncollapse",component:"block_ucla_rearrange"},{key:"allexpand",component:"block_ucla_rearrange"},{key:"allcollapse",component:"block_ucla_rearrange"}]).then(function(a){c={expand:a[0],collapse:a[1],expandall:a[2],collapseall:a[3]}})},g=function(){var a=JSON.stringify(b(d.sectionList).nestedSortable("toHierarchy"));b("#serialized").val(a)},h=function(a){var e=a.closest(d.section);e.children("ul").slideToggle(),a.text(a.text()==c.collapse?c.expand:c.collapse);var f;b(d.expand).each(function(a){return 0==a?void(f=b(this).text()):void(f!=b(this).text()&&(f=!1))}),f&&b(d.expandall).val(f==c.expand?c.expandall:c.collapseall)},i=function(){var a=b(d.expandall);a.first().val()==c.expandall?(b(d.section).children("ul").slideDown(),b(d.expand).text(c.collapse),a.val(c.collapseall)):(b(d.section).children("ul").slideUp(),b(d.expand).text(c.expand),a.val(c.expandall))};return{init:function(a,g){e(),f().then(function(){if(b(d.expand).click(function(){h(b(this))}),b(d.expandall).click(i),a>=0){var e=b(d.section+":not(#s-section-"+g+")");e.children("ul").hide(),e.find(d.expand).text(c.expand),b(d.expandall).val(c.expandall)}b(".js-show").show(),b(".js-hide").hide(),b(".btn-submit input").prop("disabled",!1)})}}});